<!DOCTYPE html>
<html lang="si">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mark Attendance</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
        }

        #success-msg {
            display: none;
        }

        .camera-container {
            border: 6px solid #28a745;
            border-radius: 20px;
            overflow: hidden;
            background-color: #000;
            box-shadow: 0 0 30px rgba(40, 167, 69, 0.3);
        }

        .scan-line {
            width: 100%;
            height: 3px;
            background-color: #28a745;
            position: absolute;
            top: 0;
            z-index: 10;
            animation: moveScan 3s infinite linear;
        }

        @keyframes moveScan {
            0% {
                top: 0;
            }

            100% {
                top: 100%;
            }
        }
    </style>
    <script>

        let checkInterval = setInterval(function () {
            fetch('/check_status')
                .then(response => response.json())
                .then(data => {
                    if (data.status === "success") {
                        clearInterval(checkInterval);
                        // ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä ‡∑Ä‡∑É‡∑è ‡∂Ø‡∂∏‡∑è ‡∑É‡∑è‡∂ª‡∑ä‡∂Æ‡∂ö ‡∂¥‡∂´‡∑í‡∑Ä‡∑í‡∂©‡∂∫ ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±
                        document.getElementById('camera-section').style.display = 'none';
                        document.getElementById('success-msg').style.display = 'block';
                    }
                })
                .catch(err => console.log("Waiting for connection..."));
        }, 1000);

        // ‡∂ö‡∑ê‡∂∏‡∂ª‡∑è‡∑Ä Load ‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂Ö‡∂¥‡∑Ñ‡∑É‡∑î ‡∂±‡∂∏‡∑ä Refresh ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∑ö ‡∂¥‡∑Ñ‡∑É‡∑î‡∂ö‡∂∏
        function handleImgError(img) {
            setTimeout(function () {
                img.src = "{{ url_for('video_feed') }}?" + new Date().getTime();
            }, 1000);
        }
    </script>
</head>

<body class="text-white text-center">

    <div class="container mt-5">
        <div id="camera-section">
            <h2 class="text-success fw-bold mb-4">üì∏ Scanning Face...</h2>

            <div class="row justify-content-center">
                <div class="col-md-8 position-relative p-0 camera-container">
                    <div class="scan-line"></div>
                    <img id="video-feed" src="{{ url_for('video_feed') }}" class="w-100" onerror="handleImgError(this)"
                        alt="Live Camera Feed">
                </div>
            </div>

            <div class="mt-4">
                <p class="lead">Show your Face.</p>
                <a href="/" class="btn btn-outline-danger px-4 shadow-sm">Cancel Scan</a>
            </div>
        </div>

        <div id="success-msg" class="animate__animated animate__zoomIn">
            <div class="card bg-white text-dark shadow-lg mx-auto p-5" style="max-width: 500px; border-radius: 25px;">
                <div class="mb-4">
                    <div class="display-1 text-success">‚úÖ</div>
                </div>
                <h2 class="fw-bold text-success">Attendance Marked!</h2>

                <div class="mt-4 d-grid gap-2">
                    <a href="/view_attendance" class="btn btn-success btn-lg rounded-pill shadow">OK - Check Records</a>
                    <a href="/" class="btn btn-light text-muted btn-sm mt-2">Back to Dashboard</a>
                </div>
            </div>
        </div>
    </div>

</body>

</html>